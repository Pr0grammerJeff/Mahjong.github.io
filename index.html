<!DOCTYPE html>
<html>
  <head>
    <title>麻雀計算機</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <header>
      <h1>東圈東局</h1>
      <div class="function-btn-container">
        <button class="function-btn">
          <div>
            <img src="images/start.png" alt="Create" width="60" height="60" />
          </div>
          <span>創建牌局</span>
        </button>
        <button class="function-btn">
          <div>
            <img src="images/reset.png" alt="Reset" width="60" height="60" />
          </div>
          <span>重設</span>
        </button>
        <button class="function-btn" onclick="setHost()">
          <div>
            <img src="images/dealer.png" alt="Dealer" width="60" height="60" />
          </div>
          <span>莊家設定</span>
        </button>
        <button class="function-btn">
          <div>
            <img src="images/giveup.png" alt="Giveup" width="60" height="60" />
          </div>
          <span>拉數/投降</span>
        </button>
        <button class="function-btn" onclick="random_sit(playerName)">
          <div>
            <img
              src="images/direction.png"
              alt="Random sit"
              width="60"
              height="60"
            />
          </div>
          <span>自動執位</span>
        </button>
      </div>
      <div class="function-btn-container">
        <button class="function-btn">
          <div>
            <img src="images/swap.png" alt="Swap" width="60" height="60" />
          </div>
          <span>換人換位</span>
        </button>
        <button class="function-btn">
          <div>
            <img
              src="images/player.png"
              alt="Add Player"
              width="60"
              height="60"
            />
          </div>
          <span>新增玩家</span>
        </button>
        <button class="function-btn">
          <div>
            <img
              src="images/cashout.png"
              alt="Cashout"
              width="60"
              height="60"
            />
          </div>
          <span>找數</span>
        </button>
        <button class="function-btn">
          <div>
            <img src="images/share.png" alt="Share" width="60" height="60" />
          </div>
          <span>分享賽果</span>
        </button>
        <button class="function-btn" onclick="dicing()">
          <div>
            <img src="images/dice.png" alt="Dicing" width="60" height="60" />
          </div>
          <span>擲骰</span>
        </button>
      </div>
    </header>
    <main>
      <div class="main-container">
        <button class="sit-btn" onclick="openPopup(1)">
          <div>
            <img
              src="images/add_player.png"
              alt="Result"
              width="60"
              height="60"
            />
          </div>
          <span>Player 1</span>
        </button>
      </div>
      <div class="main-container">
        <button class="sit-btn" onclick="openPopup(2)">
          <div>
            <img
              src="images/add_player.png"
              alt="Result"
              width="60"
              height="60"
            />
          </div>
          <span>Player 2</span>
        </button>
        <button class="skip-btn">
          <span>流局</span>
        </button>
        <button class="sit-btn" onclick="openPopup(3)">
          <div>
            <img
              src="images/add_player.png"
              alt="Result"
              width="60"
              height="60"
            />
          </div>
          <span>Player 3</span>
        </button>
      </div>
      <div class="main-container">
        <button class="sit-btn" onclick="openPopup(4)">
          <div>
            <img
              src="images/add_player.png"
              alt="Result"
              width="60"
              height="60"
            />
          </div>
          <span>Player 4</span>
        </button>
      </div>
      <footer>
        <div class="function-btn-container">
          <button class="page-btn" onclick="displayForm()">
            <div>
              <img src="images/war.png" alt="Result" width="60" height="60" />
            </div>
            <span>戰況</span>
          </button>
          <button class="page-btn">
            ]
            <div>
              <img
                src="images/stat.png"
                alt="Statistic"
                width="60"
                height="60"
              />
            </div>
            <span>統計</span>
          </button>
        </div>
      </footer>
    </main>
  </body>
</html>

<script>
  var players = [];
  function setHost() {
    // Code to open the popup screen

    // Create a select element for the player names
    var select = document.createElement("select");

    // Add option elements for each player
    players.forEach(function (player) {
      var option = document.createElement("option");
      option.value = player.playerName;
      option.text = player.playerName;
      select.appendChild(option);
    });

    // Add event listener to the select element
    select.addEventListener("change", function () {
      var selectedPlayerName = select.value;

      // Update the isHost attribute for all players
      players.forEach(function (player) {
        player.isHost = player.playerName === selectedPlayerName;
      });

      console.log(players); // Output the updated players array
    });

    // Append the select element to the popup content container
    var content = document.querySelector(".popup-content");
    content.appendChild(select);
  }

  function dicing() {
    // Check if the popup screen is already displayed
    var popupScreen = document.querySelector(".popup-screen");
    if (popupScreen) {
      return; // Exit the function if the popup screen is already displayed
    }

    var diceRoll1 = Math.floor(Math.random() * 6) + 1;
    var diceRoll2 = Math.floor(Math.random() * 6) + 1;
    var diceRoll3 = Math.floor(Math.random() * 6) + 1;
    var sum = diceRoll1 + diceRoll2 + diceRoll3;

    // Create a popup screen element
    var screen = document.createElement("div");
    screen.classList.add("popup-screen");

    // Create a popup content container
    var content = document.createElement("div");
    content.classList.add("popup-content");

    // Create a close button
    var closeButton = document.createElement("button");
    closeButton.innerHTML = "x";
    closeButton.classList.add("popup-close-button");
    closeButton.style.fontWeight = "bold";
    closeButton.style.fontSize = "30px";
    closeButton.style.position = "absolute";
    closeButton.style.top = "10px";
    closeButton.style.right = "10px";

    // Create a sum number display
    var sumDisplay = document.createElement("div");
    sumDisplay.innerHTML = sum;
    sumDisplay.style.fontWeight = "bold";
    sumDisplay.style.fontSize = "100px";
    sumDisplay.style.textAlign = "center";
    sumDisplay.style.marginBottom = "10px";

    // Create a row for dice roll images
    var diceRow = document.createElement("div");
    diceRow.style.display = "flex";
    diceRow.style.justifyContent = "center";

    // Display dice images based on dice roll values
    var diceImages = [
      "dice1.png",
      "dice2.png",
      "dice3.png",
      "dice4.png",
      "dice5.png",
      "dice6.png",
    ];

    var img1 = document.createElement("img");
    img1.src = "images/" + diceImages[diceRoll1 - 1];
    img1.style.width = "100px";
    img1.style.height = "100px";
    diceRow.appendChild(img1);

    var img2 = document.createElement("img");
    img2.src = "images/" + diceImages[diceRoll2 - 1];
    img2.style.width = "100px";
    img2.style.height = "100px";
    diceRow.appendChild(img2);

    var img3 = document.createElement("img");
    img3.src = "images/" + diceImages[diceRoll3 - 1];
    img3.style.width = "100px";
    img3.style.height = "100px";
    diceRow.appendChild(img3);

    // Append the sum, dice row, and close button to the popup content container
    content.appendChild(closeButton);
    content.appendChild(sumDisplay);
    content.appendChild(diceRow);

    // Append the popup content container to the popup screen
    screen.appendChild(content);

    // Add event listener to the close button
    closeButton.addEventListener("click", closePopup);

    // Append the popup screen to the body
    document.body.appendChild(screen);
  }

  function closePopup() {
    var popupScreen = document.querySelector(".popup-screen");
    popupScreen.remove();
  }

  function createPlayer(playerNum, playerName, Avatar, isHost, balance) {
    var player = {
      num: playerNum,
      name: playerName,
      avatar: Avatar,
      isHost: isHost,
      balance: balance,
    };

    players[playerNum] = player;
    console.log(players);

    // Perform any additional operations or validations as needed

    return player;
  }
  function openPopup(playerNumber) {
    // Create a popup screen element
    var screen = document.createElement("div");
    screen.classList.add("popup-screen");

    // Create a popup content container
    var content = document.createElement("div");
    content.classList.add("popup-content");

    // Create a close button
    var closeButton = document.createElement("button");
    closeButton.innerHTML = "x";
    closeButton.classList.add("popup-close-button");
    closeButton.style.fontWeight = "bold";
    closeButton.style.fontSize = "20px";
    closeButton.style.position = "absolute";
    closeButton.style.top = "10px";
    closeButton.style.right = "10px";

    // Add event listener to close the screen when the close button is clicked
    closeButton.addEventListener("click", function () {
      document.body.removeChild(screen);
    });

    // Create a title element
    var title = document.createElement("div");
    title.classList.add("popup-title");
    title.textContent = "請選擇頭像並輸入你的名字";
    title.style.fontWeight = "bold";
    title.style.fontSize = "28px";

    // Create a container for avatar selection
    var avatarContainer = document.createElement("div");
    avatarContainer.classList.add("avatar-container");

    // Create avatar images
    for (var i = 1; i <= 8; i++) {
      var avatar = document.createElement("img");
      avatar.src = "images/" + i + ".jpeg";
      avatar.classList.add("avatar-image");
      avatar.style.objectFit = "cover"; // Ensure the image fills the square container
      avatar.style.width = "100px"; // Set the width to the desired square size
      avatar.style.height = "100px"; // Set the height to the desired square size
      avatar.style.margin = "5px"; // Add some margin around each image

      avatar.addEventListener("click", function () {
        var selectedAvatar = this.src;
        var selectedAvatarPreview = document.querySelector(
          ".selected-avatar-preview"
        );
        selectedAvatarPreview.src = selectedAvatar;
      });

      avatarContainer.appendChild(avatar);
    }

    // Adjust container width based on window size
    var containerWidth = Math.min((100 + 10) * 4 + 10, window.innerWidth);
    avatarContainer.style.width = containerWidth + "px";
    avatarContainer.style.overflowX = "auto";

    // Create a text input element
    var input = document.createElement("input");
    input.type = "text";
    input.placeholder = "";
    input.classList.add("popup-input");
    input.style.textAlign = "center";
    input.style.height = "90px";
    input.style.fontWeight = "bold";
    input.style.fontSize = "28px";

    // Create a submit button
    var submitBtn = document.createElement("button");
    submitBtn.innerHTML = "確定";
    submitBtn.classList.add("popup-button");
    submitBtn.style.fontWeight = "bold";
    submitBtn.style.fontSize = "28px";

    // Create a selected avatar preview element
    var selectedAvatarPreview = document.createElement("img");
    selectedAvatarPreview.classList.add("selected-avatar-preview");
    selectedAvatarPreview.src = "images/default.png";
    selectedAvatarPreview.style.width = "240px";
    selectedAvatarPreview.style.height = "240px";

    // Add the elements to the content container
    content.appendChild(closeButton);
    content.appendChild(title);
    content.appendChild(avatarContainer);
    content.appendChild(selectedAvatarPreview);
    content.appendChild(input);
    content.appendChild(submitBtn);

    // Add the content container to the screen
    screen.appendChild(content);

    // Append the screen to the body
    document.body.appendChild(screen);

    // Add event listener to the submit button
    submitBtn.addEventListener("click", function () {
      if (input.value != "") {
        var playerName = input.value;

        // Show the player name in the middle of the corresponding button
        var button = document.querySelector(
          ".sit-btn:nth-of-type(" + playerNumber + ")"
        );
        button.innerHTML = playerName;
        button.style.fontWeight = "bold";
        button.style.fontSize = "28px";

        // Show the chosen image above the player name
        var selectedAvatar = selectedAvatarPreview.src;
        var avatarImage = document.createElement("img");
        avatarImage.src = selectedAvatar;
        avatarImage.style.display = "block";
        avatarImage.style.margin = "auto";
        avatarImage.style.width = "200px"; // Set the desired width

        // Apply square cropping
        avatarImage.style.objectFit = "cover";
        avatarImage.style.objectPosition = "center";

        // Apply square dimensions
        avatarImage.style.height = "200px";

        button.prepend(avatarImage);

        // Create the player object
        var isHost = false;
        var balance = 0;
        var playerNum = playerNumber;
        var newPlayer = createPlayer(
          playerNum,
          playerName,
          selectedAvatar,
          isHost,
          balance
        );
        console.log(newPlayer); // Output the created player object

        // Remove the screen
        document.body.removeChild(screen);
      } else {
        // Check if error message already exists
        var errorMessage = document.querySelector(".error-message");
        if (!errorMessage) {
          // Create an error message element
          errorMessage = document.createElement("div");
          errorMessage.textContent = "名字不能為空";
          errorMessage.classList.add("error-message");
          errorMessage.style.color = "red";
          errorMessage.style.fontSize = "28px";
          errorMessage.style.marginTop = "10px";

          // Insert the error message below the input element
          input.parentNode.insertBefore(errorMessage, input.nextSibling);
        }
      }
    });

    // Add event listener to close the screen when clicking outside of it
    window.addEventListener("click", function (event) {
      if (event.target === screen) {
        document.body.removeChild(screen);
      }
    });
  }
  function random_sit(playerName) {
    var buttons = document.querySelectorAll(".sit-btn");
    var randomIndices = [];

    // Generate 4 random indices without repetition
    while (randomIndices.length < 4) {
      var randomIndex = Math.floor(Math.random() * buttons.length);
      if (!randomIndices.includes(randomIndex)) {
        randomIndices.push(randomIndex);
      }
    }

    // Assign player name to the randomly selected buttons
    randomIndices.forEach(function (index) {
      var button = buttons[index];
      button.innerHTML = playerName;
      button.style.fontWeight = "bold";
      button.style.fontSize = "28px";
    });
  }

  function displayForm() {
    console.log("DisplayForm")
    // Create a popup screen
    var popup = document.createElement("div");
    popup.classList.add("popup");

    // Create a close button
    var closeButton = document.createElement("button");
    closeButton.textContent = "Close";
    closeButton.classList.add("close-button");

    // Append the close button to the popup screen
    popup.appendChild(closeButton);

    // Create a form element
    var form = document.createElement("form");
    form.classList.add("player-form");

    // Create a table element
    var table = document.createElement("table");
    table.classList.add("player-table");

    // Create table headers
    var tableHeaderRow = document.createElement("tr");
    players.forEach(function (name) {
      var tableHeader = document.createElement("th");
      tableHeader.textContent = name;
      tableHeaderRow.appendChild(tableHeader);
    });
    table.appendChild(tableHeaderRow);

    // Create table rows with input fields
    var tableRow = document.createElement("tr");
    players.forEach(function (name) {
      var tableData = document.createElement("td");
      var input = document.createElement("input");
      input.type = "text";
      input.classList.add("player-input");
      tableData.textContent = name;
      tableData.appendChild(input);
      tableRow.appendChild(tableData);
    });
    table.appendChild(tableRow);

    // Add the table to the form
    form.appendChild(table);

    // Append the form to the popup screen
    popup.appendChild(form);

    // Append the popup screen to the body
    document.body.appendChild(popup);

    // Add event listener to the close button
    closeButton.addEventListener("click", function () {
      document.body.removeChild(popup);
    });
  }

  // Add event listener to the "戰況" button
  var statusButton = document.querySelector(".page-btn");
  statusButton.addEventListener("click", displayForm);
</script>
