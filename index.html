<!DOCTYPE html>
<html>
  <head>
    <title>麻雀計算機</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <header>
      <h1>東圈東局</h1>
      <div class="function-btn-container">
        <button class="reset-btn" onclick="reset()">
          <div>
            <img src="images/start.png" alt="Create" width="60" height="60" />
          </div>
          <span>創建牌局</span>
        </button>
        <button class="function-btn">
          <div>
            <img src="images/reset.png" alt="Reset" width="60" height="60" />
          </div>
          <span>還原</span>
        </button>
        <button class="setHost-btn" onclick="setHost()">
          <div>
            <img src="images/dealer.png" alt="Dealer" width="60" height="60" />
          </div>
          <span>莊家設定</span>
        </button>
        <button class="function-btn">
          <div>
            <img src="images/giveup.png" alt="Giveup" width="60" height="60" />
          </div>
          <span>拉數/投降</span>
        </button>
        <button class="function-btn" onclick="random_sit(players)">
          <div>
            <img
              src="images/direction.png"
              alt="Random sit"
              width="60"
              height="60"
            />
          </div>
          <span>自動執位</span>
        </button>
      </div>
      <div class="function-btn-container">
        <button class="function-btn">
          <div>
            <img src="images/swap.png" alt="Swap" width="60" height="60" />
          </div>
          <span>換人換位</span>
        </button>
        <button class="function-btn">
          <div>
            <img
              src="images/player.png"
              alt="Add Player"
              width="60"
              height="60"
            />
          </div>
          <span>新增玩家</span>
        </button>
        <button class="function-btn">
          <div>
            <img
              src="images/cashout.png"
              alt="Cashout"
              width="60"
              height="60"
            />
          </div>
          <span>找數</span>
        </button>
        <button class="share-btn" onclick="share()">
          <div>
            <img src="images/share.png" alt="Share" width="60" height="60" />
          </div>
          <span>分享賽果</span>
        </button>
        <button class="function-btn" onclick="dicing()">
          <div>
            <img src="images/dice.png" alt="Dicing" width="60" height="60" />
          </div>
          <span>擲骰</span>
        </button>
      </div>
    </header>
    <main>
      <div style="margin: 50px">
        <div class="main-container">
          <button class="sit-btn-1" onclick="openPopup(1)">
            <div>
              <img
                src="images/add_player.png"
                alt="Result"
                width="60"
                height="60"
              />
            </div>
            <span>Player 1</span>
          </button>
        </div>
        <div class="main-container">
          <button class="sit-btn-2" onclick="openPopup(2)">
            <div>
              <img
                src="images/add_player.png"
                alt="Result"
                width="60"
                height="60"
              />
            </div>
            <span>Player 2</span>
          </button>
          <button class="skip-btn" onclick="AddIsHost()">
            <span style="font-size: 40px">流局</span>
          </button>
          <button class="sit-btn-3" onclick="openPopup(3)">
            <div>
              <img
                src="images/add_player.png"
                alt="Result"
                width="60"
                height="60"
              />
            </div>
            <span>Player 3</span>
          </button>
        </div>
        <div class="main-container">
          <button class="sit-btn-4" onclick="openPopup(4)">
            <div>
              <img
                src="images/add_player.png"
                alt="Result"
                width="60"
                height="60"
              />
            </div>
            <span>Player 4</span>
          </button>
        </div>
      </div>
      <footer>
        <div class="function-btn-container">
          <button class="page-btn" onclick="displayForm()">
            <div>
              <img src="images/war.png" alt="Result" width="60" height="60" />
            </div>
            <span>戰況</span>
          </button>
          <button class="page-btn">
            <div>
              <img
                src="images/stat.png"
                alt="Statistic"
                width="60"
                height="60"
              />
            </div>
            <span>統計</span>
          </button>
        </div>
      </footer>
    </main>
  </body>
</html>

<script>
  var players = new Array(4);
  players[0] = "";
  console.log(players);

  function displayPopup() {
    // Check if the popup screen  is already displayed
    var popupScreen = document.querySelector(".popup-screen");
    if (popupScreen) {
      return; // Exit the function if the popup screen is already displayed
    }

    // Create a popup screen element
    var screen = document.createElement("div");
    screen.classList.add("popup-screen");

    // Create a popup content container
    var content = document.createElement("div");
    content.classList.add("popup-content");

    // Create a close button
    var closeButton = document.createElement("button");
    closeButton.innerHTML = "x";
    closeButton.classList.add("popup-close-button");
    closeButton.style.fontWeight = "bold";
    closeButton.style.fontSize = "30px";
    closeButton.style.position = "absolute";
    closeButton.style.top = "10px";
    closeButton.style.right = "10px";

    content.appendChild(closeButton);

    // Append the popup content container to the popup screen
    screen.appendChild(content);

    // Add event listener to the close button
    closeButton.addEventListener("click", closePopup);

    // Append the popup screen to the body
    document.body.appendChild(screen);
  }

  function reset() {
    // Check if the popup screen is already displayed
    var popupScreen = document.querySelector(".popup-screen");
    if (popupScreen) {
      return; // Exit the function if the popup screen is already displayed
    }

    // Create a popup screen
    displayPopup();

    // Add  "開始牌局" message
    const message = document.createElement("p");
    message.innerText = "開始牌局";
    message.style.fontSize = "80px";
    message.classList.add("popup-message");

    // Add a "確定" button
    var confirmButton = document.createElement("button");
    confirmButton.innerHTML = "確定";
    confirmButton.style.marginTop = "20px";
    confirmButton.style.padding = "10px 20px";
    confirmButton.style.fontSize = "28px";
    confirmButton.style.backgroundColor = "white";
    confirmButton.style.color = "black";
    confirmButton.style.border = "solid";
    confirmButton.style.cursor = "pointer";
    confirmButton.style.display = "block";
    confirmButton.style.margin = "0 auto";

    var popupContent = document.querySelector(".popup-content");
    popupContent.appendChild(message);
    popupContent.appendChild(confirmButton);
  }

  // Add event listener to the button press
  var button = document.querySelector(".reset-btn");
  button.addEventListener("click", reset);

  function dicing() {
    // Check if the popup screen is already displayed
    var popupScreen = document.querySelector(".popup-screen");
    if (popupScreen) {
      return; // Exit the function if the popup screen is already displayed
    }

    var diceRoll1 = Math.floor(Math.random() * 6) + 1;
    var diceRoll2 = Math.floor(Math.random() * 6) + 1;
    var diceRoll3 = Math.floor(Math.random() * 6) + 1;
    
    var sum = diceRoll1 + diceRoll2 + diceRoll3;

    // Create a popup screen element
    var screen = document.createElement("div");
    screen.classList.add("popup-screen");

    // Create a popup content container
    var content = document.createElement("div");
    content.classList.add("popup-content");

    // Create a close button
    var closeButton = document.createElement("button");
    closeButton.innerHTML = "x";
    closeButton.classList.add("popup-close-button");
    closeButton.style.fontWeight = "bold";
    closeButton.style.fontSize = "30px";
    closeButton.style.position = "absolute";
    closeButton.style.top = "10px";
    closeButton.style.right = "10px";

    // Create a sum number display
    var sumDisplay = document.createElement("div");
    sumDisplay.innerHTML = sum;
    sumDisplay.style.fontWeight = "bold";
    sumDisplay.style.fontSize = "100px";
    sumDisplay.style.textAlign = "center";
    sumDisplay.style.marginBottom = "10px";

    // Create a row for dice roll images
    var diceRow = document.createElement("div");
    diceRow.style.display = "flex";
    diceRow.style.justifyContent = "center";

    // Display dice images based on dice roll values
    var diceImages = [
      "dice1.png",
      "dice2.png",
      "dice3.png",
      "dice4.png",
      "dice5.png",
      "dice6.png",
    ];

    var img1 = document.createElement("img");
    img1.src = "images/" + diceImages[diceRoll1 - 1];
    img1.style.width = "100px";
    img1.style.height = "100px";
    diceRow.appendChild(img1);

    var img2 = document.createElement("img");
    img2.src = "images/" + diceImages[diceRoll2 - 1];
    img2.style.width = "100px";
    img2.style.height = "100px";
    diceRow.appendChild(img2);

    var img3 = document.createElement("img");
    img3.src = "images/" + diceImages[diceRoll3 - 1];
    img3.style.width = "100px";
    img3.style.height = "100px";
    diceRow.appendChild(img3);

    // Append the sum, dice row, and close button to the popup content container
    content.appendChild(closeButton);
    content.appendChild(sumDisplay);
    content.appendChild(diceRow);

    // Append the popup content container to the popup screen
    screen.appendChild(content);

    if (diceRoll1 === diceRoll2 && diceRoll2 === diceRoll3) {
      // Create an image element
      var image = document.createElement("img");
      image.src = "images/goal.gif";
      image.style.width = "600px";
      image.style.height = "400px";
      sumDisplay.style.color = "red";
      content.appendChild(image);
    }

    if (diceRoll1 == 1 || diceRoll2 == 1 || diceRoll3 == 1)
      if (diceRoll1 == 2 || diceRoll2 == 2 || diceRoll3 == 2)
        if (diceRoll1 == 3 || diceRoll2 == 3 || diceRoll3 == 3) {
          // Create an image element
          var image = document.createElement("img");
          image.src = "images/123.gif";
          image.style.width = "600px";
          image.style.height = "400px";
          sumDisplay.style.color = "red";
          content.appendChild(image);
        }

    // Add event listener to the close button
    closeButton.addEventListener("click", closePopup);

    // Append the popup screen to the body
    document.body.appendChild(screen);
  }

  function closePopup() {
    var popupScreen = document.querySelector(".popup-screen");
    popupScreen.remove();
  }

  function createPlayer(playerNum, playerName, Avatar, isHost, balance) {
    var player = {
      num: playerNum,
      name: playerName,
      avatar: Avatar,
      isHost: isHost,
      balance: balance,
    };
    players[playerNum] = player;
    // Perform any additional operations or validations as needed
    return player;
  }

  function setHost() {
    // Check if the popup screen is already displayed
    var popupScreen = document.querySelector(".popup-screen");
    if (popupScreen || players.includes(null)) {
      return; // Exit the function if the popup screen is already displayed
    }

    // Create a popup screen
    displayPopup();

    // Create the list selector container
    const playersListContainer = document.createElement("div");
    playersListContainer.classList.add("players-list-container");

    // Apply styles to the list container for scrolling
    playersListContainer.style.overflow = "auto";
    playersListContainer.style.maxHeight = "400px";

    // Create the list selector
    const playersList = document.createElement("ul");
    playersList.classList.add("players-list");

    // Create list items for each player
    players.forEach((player) => {
      const listItem = document.createElement("li");
      listItem.innerText = player.name;
      listItem.addEventListener("click", () => {
        players.forEach((p) => {
          p.isHost = p === player ? 1 : 0;
        });
      });
      playersList.appendChild(listItem);
    });

    // Add the list selector to the container
    playersListContainer.appendChild(playersList);

    // Add a "確定" button
    var confirmButton = document.createElement("button");
    confirmButton.innerHTML = "確定";
    confirmButton.style.marginTop = "20px";
    confirmButton.style.padding = "10px 20px";
    confirmButton.style.fontSize = "28px";
    confirmButton.style.backgroundColor = "white";
    confirmButton.style.color = "black";
    confirmButton.style.border = "solid";
    confirmButton.style.cursor = "pointer";
    confirmButton.style.display = "block";
    confirmButton.style.margin = "0 auto";

    confirmButton.addEventListener("click", () => {
      popupScreen.remove(); // Close the popup when the confirm button is clicked
    });

    // Add the list selecto fr container and confirm button to the popup content
    var popupContent = document.querySelector(".popup-content");
    popupContent.appendChild(playersListContainer);
    popupContent.appendChild(confirmButton);
  }

  // Add event listener to the button press
  var button = document.querySelector(".setHost-btn");
  button.addEventListener("click", setHost);

  function openPopup(playerNumber) {
    // Check if the popup screen is already displayed
    var popupScreen = document.querySelector(".popup-screen");
    if (popupScreen) {
      return; // Exit the function if the popup screen is already displayed
    }

    // Create a popup screen element
    var screen = document.createElement("div");
    screen.classList.add("popup-screen");

    // Create a popup content container
    var content = document.createElement("div");
    content.classList.add("popup-content");

    // Create a close button
    var closeButton = document.createElement("button");
    closeButton.innerHTML = "x";
    closeButton.classList.add("popup-close-button");
    closeButton.style.fontWeight = "bold";
    closeButton.style.fontSize = "20px";
    closeButton.style.position = "absolute";
    closeButton.style.top = "10px";
    closeButton.style.right = "10px";

    // Add event listener to close the screen when the close button is clicked
    closeButton.addEventListener("click", function () {
      document.body.removeChild(screen);
    });

    // Create a title element
    var title = document.createElement("div");
    title.classList.add("popup-title");
    title.textContent = "請選擇頭像並輸入你的名字";
    title.style.fontWeight = "bold";
    title.style.fontSize = "28px";

    // Create a container for avatar selection
    var avatarContainer = document.createElement("div");
    avatarContainer.classList.add("avatar-container");

    // Create avatar images
    for (var i = 1; i <= 8; i++) {
      var avatar = document.createElement("img");
      avatar.src = "images/" + i + ".jpeg";
      avatar.classList.add("avatar-image");
      avatar.style.objectFit = "cover"; // Ensure the image fills the square container
      avatar.style.width = "100px"; // Set the width to the desired square size
      avatar.style.height = "100px"; // Set the height to the desired square size
      avatar.style.margin = "5px"; // Add some margin around each image

      avatar.addEventListener("click", function () {
        var selectedAvatar = this.src;
        var selectedAvatarPreview = document.querySelector(
          ".selected-avatar-preview"
        );
        selectedAvatarPreview.src = selectedAvatar;
      });

      avatarContainer.appendChild(avatar);
    }

    // Adjust container width based on window size
    var containerWidth = Math.min((100 + 10) * 4 + 10, window.innerWidth);
    avatarContainer.style.width = containerWidth + "px";
    avatarContainer.style.overflowX = "auto";

    // Create a text input element
    var input = document.createElement("input");
    input.type = "text";
    input.placeholder = "";
    input.classList.add("popup-input");
    input.style.textAlign = "center";
    input.style.height = "90px";
    input.style.fontWeight = "bold";
    input.style.fontSize = "28px";

    // Create a submit button
    var submitBtn = document.createElement("button");
    submitBtn.innerHTML = "確定";
    submitBtn.classList.add("popup-button");
    submitBtn.style.fontWeight = "bold";
    submitBtn.style.fontSize = "28px";

    // Create a selected avatar preview element
    var selectedAvatarPreview = document.createElement("img");
    selectedAvatarPreview.classList.add("selected-avatar-preview");
    selectedAvatarPreview.src = "images/default.png";
    selectedAvatarPreview.style.width = "240px";
    selectedAvatarPreview.style.height = "240px";

    // Add the elements to the content container
    content.appendChild(closeButton);
    content.appendChild(title);
    content.appendChild(avatarContainer);
    content.appendChild(selectedAvatarPreview);
    content.appendChild(input);
    content.appendChild(submitBtn);

    // Add the content container to the screen
    screen.appendChild(content);

    // Append the screen to the body
    document.body.appendChild(screen);

    // Add event listener to the submit button
    submitBtn.addEventListener("click", function () {
      if (input.value != "") {
        var playerName = input.value;
        // Show the player name in the middle of the corresponding button
        var button = document.querySelector(".sit-btn-" + playerNumber);
        button.innerHTML = playerName;
        button.style.fontWeight = "bold";
        button.style.fontSize = "28px";

        // Show the chosen image above the player name
        var selectedAvatar = selectedAvatarPreview.src;
        var avatarImage = document.createElement("img");
        avatarImage.src = selectedAvatar;
        avatarImage.style.display = "block";
        avatarImage.style.margin = "auto";
        avatarImage.style.width = "200px"; // Set the desired width

        // Apply square cropping
        avatarImage.style.objectFit = "cover";
        avatarImage.style.objectPosition = "center";

        // Apply square dimensions
        avatarImage.style.height = "200px";

        button.prepend(avatarImage);

        // Create the player object
        var isHost = 0;
        var balance = 0;
        var playerNum = playerNumber;
        var newPlayer = createPlayer(
          playerNum,
          playerName,
          selectedAvatar,
          isHost,
          balance
        );

        // Remove the screen
        document.body.removeChild(screen);
      } else {
        // Check if error message already exists
        var errorMessage = document.querySelector(".error-message");
        if (!errorMessage) {
          // Create an error message element
          errorMessage = document.createElement("div");
          errorMessage.textContent = "名字不能為空";
          errorMessage.classList.add("error-message");
          errorMessage.style.color = "red";
          errorMessage.style.fontSize = "28px";
          errorMessage.style.marginTop = "10px";

          // Insert the error message below the input element
          input.parentNode.insertBefore(errorMessage, input.nextSibling);
        }
      }
    });
  }
  function random_sit(array) {
    console.log(array);
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function displayForm() {
    console.log("DisplayForm");
    // Create a popup screen
    var popup = document.createElement("div");
    popup.classList.add("popup");

    // Create a close button
    var closeButton = document.createElement("button");
    closeButton.textContent = "Close";
    closeButton.classList.add("close-button");

    // Append the close button to the popup screen
    popup.appendChild(closeButton);

    // Create a form element
    var form = document.createElement("form");
    form.classList.add("player-form");

    // Create a table element
    var table = document.createElement("table");
    table.classList.add("player-table");

    // Create table headers
    var tableHeaderRow = document.createElement("tr");
    players.forEach(function (name) {
      var tableHeader = document.createElement("th");
      tableHeader.textContent = name;
      tableHeaderRow.appendChild(tableHeader);
    });
    table.appendChild(tableHeaderRow);

    // Create table rows with input fields
    var tableRow = document.createElement("tr");
    players.forEach(function (name) {
      var tableData = document.createElement("td");
      var input = document.createElement("input");
      input.type = "text";
      input.classList.add("player-input");
      tableData.textContent = name;
      tableData.appendChild(input);
      tableRow.appendChild(tableData);
    });
    table.appendChild(tableRow);

    // Add the table to the form
    form.appendChild(table);

    // Append the form to the popup screen
    popup.appendChild(form);

    // Append the popup screen to the body
    document.body.appendChild(popup);

    // Add event listener to the close button
    closeButton.addEventListener("click", function () {
      document.body.removeChild(popup);
    });
  }

  // Add event listener to the "戰況" button
  var statusButton = document.querySelector(".page-btn");
  statusButton.addEventListener("click", displayForm);

  function share() {
    // Check if the popup screen is already displayed
    var popupScreen = document.querySelector(".popup-screen");
    if (popupScreen) {
      return; // Exit the function if the popup screen is already displayed
    }

    // Create a popup screen element
    var screen = document.createElement("div");
    screen.classList.add("popup-screen");

    // Create a popup content container
    var content = document.createElement("div");
    content.classList.add("popup-content");

    // Create a close button
    var closeButton = document.createElement("button");
    closeButton.innerHTML = "x";
    closeButton.classList.add("popup-close-button");
    closeButton.style.fontWeight = "bold";
    closeButton.style.fontSize = "30px";
    closeButton.style.position = "absolute";
    closeButton.style.top = "10px";
    closeButton.style.right = "10px";

    content.appendChild(closeButton);

    // Create share options
    var shareOptions = document.createElement("div");
    shareOptions.classList.add("share-options");

    // Create share buttons
    var whatsappButton = document.createElement("button");
    whatsappButton.innerHTML = "Share via WhatsApp";
    whatsappButton.addEventListener("click", function () {
      // Handle WhatsApp sharing logic here
      console.log("Sharing via WhatsApp");
    });

    var emailButton = document.createElement("button");
    emailButton.innerHTML = "Share via Email";
    emailButton.addEventListener("click", function () {
      // Handle email sharing logic here
      console.log("Sharing via Email");
    });

    var messageButton = document.createElement("button");
    messageButton.innerHTML = "Share via Message";
    messageButton.addEventListener("click", function () {
      // Handle messaging sharing logic here
      console.log("Sharing via Message");
    });

    shareOptions.appendChild(whatsappButton);
    shareOptions.appendChild(emailButton);
    shareOptions.appendChild(messageButton);

    content.appendChild(shareOptions);

    // Append the popup content container to the popup screen
    screen.appendChild(content);

    // Add event listener to the close button
    closeButton.addEventListener("click", function () {
      document.body.removeChild(screen);
    });

    // Append the popup screen to the body
    document.body.appendChild(screen);
  }

  // Add event listener to the share button press
  var shareButton = document.getElementById("share-btn");
  shareButton.addEventListener("click", share);

  function AddIsHost() {
    // Create a popup screen element
    var screen = document.createElement("div");
    screen.classList.add("popup-screen");

    // Create a popup content container
    var content = document.createElement("div");
    content.classList.add("popup-content");

    // Create a close button
    var closeButton = document.createElement("button");
    closeButton.innerHTML = "x";
    closeButton.classList.add("popup-close-button");
    closeButton.style.fontWeight = "bold";
    closeButton.style.fontSize = "30px";
    closeButton.style.position = "absolute";
    closeButton.style.top = "10px";
    closeButton.style.right = "10px";

    // Add event listener to the close button
    closeButton.addEventListener("click", function () {
      // Close the popup screen
      document.body.removeChild(screen);
    });

    content.appendChild(closeButton);

    // Create confirm message
    var confirmMessage = document.createElement("p");
    confirmMessage.innerHTML = "確定流局?";
    confirmMessage.style.fontSize = "60px";
    content.appendChild(confirmMessage);

    // Create confirm button
    var confirmButton = document.createElement("button");
    confirmButton.innerHTML = "確定";
    confirmButton.style.fontWeight = "bold";
    confirmButton.style.fontSize = "28px";
    confirmButton.addEventListener("click", function () {
      // Close the popup screen
      document.body.removeChild(screen);

      // Increase the isHost value by 1 for players whose isHost value is not equal to 0
      for (var i = 0; i < players.length; i++) {
        if (players[i].isHost !== 0) {
          players[i].isHost += 1;
        }
      }
    });
    content.appendChild(confirmButton);

    // Append the popup content container to the popup screen
    screen.appendChild(content);

    // Append the popup screen to the body
    document.body.appendChild(screen);
  }

  // Add event listener to the skip button press
  var skipButton = document.getElementById("skip-btn");
  skipButton.addEventListener("click", AddIsHost);
</script>
